# Facebookæ•°æ®å±•ç¤ºç¨‹åº - ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºPHP + JSONæ–‡ä»¶å­˜å‚¨çš„ç”¨æˆ·è®¤è¯å’Œæˆæƒç®¡ç†ç³»ç»Ÿï¼Œç”¨äºæ§åˆ¶Facebookæ•°æ®å±•ç¤ºç¨‹åºçš„ä½¿ç”¨æƒé™ã€‚

### ğŸ¯ ä¸»è¦åŠŸèƒ½

1. **ç”¨æˆ·è®¤è¯** - ç”¨æˆ·åå¯†ç ç™»å½•éªŒè¯
2. **è®¾å¤‡ç®¡ç†** - é™åˆ¶åŒæ—¶åœ¨çº¿çš„è®¾å¤‡æ•°é‡
3. **æ—¶é—´æ§åˆ¶** - æˆæƒåˆ°æœŸæ—¶é—´å’Œæ¯æ—¥ä½¿ç”¨æ—¶é•¿é™åˆ¶
4. **å®æ—¶ç›‘æ§** - å¿ƒè·³æ£€æµ‹å’Œåœ¨çº¿çŠ¶æ€ç®¡ç†
5. **åå°ç®¡ç†** - å¯è§†åŒ–ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒç”¨æˆ·ç»­è´¹

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
Pythonå®¢æˆ·ç«¯ â†â†’ PHPåå°API â†â†’ JSONæ•°æ®æ–‡ä»¶
     â†“
  è®¤è¯æ¨¡å—é›†æˆåˆ°ä¸»ç¨‹åº
```

## ğŸ“ ç›®å½•ç»“æ„

```
auth_backend/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.php          # ç³»ç»Ÿé…ç½®æ–‡ä»¶
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ auth.php            # ç”¨æˆ·è®¤è¯API
â”‚   â””â”€â”€ admin.php           # ç®¡ç†å‘˜API
â”œâ”€â”€ admin/
â”‚   â””â”€â”€ index.html          # ç®¡ç†åå°ç•Œé¢
â”œâ”€â”€ data/                   # æ•°æ®å­˜å‚¨ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ users.json          # ç”¨æˆ·æ•°æ®
â”‚   â”œâ”€â”€ licenses.json       # æˆæƒæ•°æ®
â”‚   â”œâ”€â”€ sessions.json       # ä¼šè¯æ•°æ®
â”‚   â””â”€â”€ logs.json           # æ“ä½œæ—¥å¿—
â”œâ”€â”€ init_system.php         # ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬
â””â”€â”€ README.md              # è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç³»ç»Ÿåˆå§‹åŒ–

```bash
# è¿›å…¥åå°ç›®å½•
cd auth_backend

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
php init_system.php
```

### 2. å¯åŠ¨WebæœåŠ¡

ç¡®ä¿ä½ çš„WebæœåŠ¡å™¨ï¼ˆå¦‚Apache/Nginxï¼‰è¿è¡Œåœ¨80ç«¯å£ï¼Œæˆ–è€…ä½¿ç”¨PHPå†…ç½®æœåŠ¡å™¨ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼ˆè®¤è¯åå°ä½¿ç”¨80ç«¯å£ï¼‰
php -S localhost:80
```

**æ³¨æ„**ï¼šä¸»ç¨‹åºçš„backend_service.pyä½¿ç”¨8805ç«¯å£ï¼Œè®¤è¯åå°ä½¿ç”¨80ç«¯å£ã€‚

### 3. è®¿é—®ç®¡ç†åå°

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost/auth_backend/admin/`

**ç®¡ç†å‘˜å¯†é’¥ï¼š** `fb_admin_2025`

### 4. æµ‹è¯•è®¤è¯ç³»ç»Ÿ

```bash
# è¿è¡ŒPythonæµ‹è¯•è„šæœ¬
python auth_client.py
```

**æµ‹è¯•è´¦å·ï¼š**
- ç”¨æˆ·åï¼š`test_user`ï¼Œå¯†ç ï¼š`123456`
- ç”¨æˆ·åï¼š`demo_user`ï¼Œå¯†ç ï¼š`demo123`

## ğŸ“¡ APIæ¥å£æ–‡æ¡£

### ç”¨æˆ·è®¤è¯API (`/auth_backend/api/auth.php`)

#### 1. ç”¨æˆ·ç™»å½•
```
POST /auth_backend/api/auth.php
å‚æ•°ï¼š
- action: login
- username: ç”¨æˆ·å
- password: å¯†ç 
- device_id: è®¾å¤‡å”¯ä¸€æ ‡è¯†

è¿”å›ï¼š
{
  "status": "success|error",
  "message": "æ¶ˆæ¯",
  "data": {
    "token": "ä¼šè¯ä»¤ç‰Œ",
    "user_id": ç”¨æˆ·ID,
    "username": "ç”¨æˆ·å",
    "expire_date": "æˆæƒåˆ°æœŸæ—¶é—´",
    "max_simulators": æœ€å¤§è®¾å¤‡æ•°,
    "max_daily_hours": æ¯æ—¥æœ€å¤§ä½¿ç”¨æ—¶é•¿
  }
}
```

#### 2. éªŒè¯è®¤è¯çŠ¶æ€
```
POST /auth_backend/api/auth.php
å‚æ•°ï¼š
- action: verify
- token: ä¼šè¯ä»¤ç‰Œ

è¿”å›ï¼š
{
  "status": "success|error",
  "message": "æ¶ˆæ¯",
  "data": {
    "user_id": ç”¨æˆ·ID,
    "username": "ç”¨æˆ·å",
    "expire_date": "æˆæƒåˆ°æœŸæ—¶é—´",
    "daily_usage": ä»Šæ—¥ä½¿ç”¨æ—¶é•¿(åˆ†é’Ÿ),
    "max_daily_hours": æ¯æ—¥æœ€å¤§ä½¿ç”¨æ—¶é•¿
  }
}
```

#### 3. å¿ƒè·³æ›´æ–°
```
POST /auth_backend/api/auth.php
å‚æ•°ï¼š
- action: heartbeat
- token: ä¼šè¯ä»¤ç‰Œ

è¿”å›ï¼š
{
  "status": "success|error",
  "message": "æ¶ˆæ¯"
}
```

#### 4. ç”¨æˆ·ç™»å‡º
```
POST /auth_backend/api/auth.php
å‚æ•°ï¼š
- action: logout
- token: ä¼šè¯ä»¤ç‰Œ

è¿”å›ï¼š
{
  "status": "success|error",
  "message": "æ¶ˆæ¯"
}
```

### ç®¡ç†å‘˜API (`/auth_backend/api/admin.php`)

æ‰€æœ‰ç®¡ç†å‘˜APIéƒ½éœ€è¦æä¾› `admin_key` å‚æ•°ï¼š`fb_admin_2025`

#### 1. åˆ›å»ºç”¨æˆ·
```
POST /auth_backend/api/admin.php
å‚æ•°ï¼š
- action: create_user
- admin_key: ç®¡ç†å‘˜å¯†é’¥
- username: ç”¨æˆ·å
- password: å¯†ç 
- email: é‚®ç®±ï¼ˆå¯é€‰ï¼‰
- expire_days: æœ‰æ•ˆæœŸå¤©æ•°
- max_simulators: æœ€å¤§è®¾å¤‡æ•°
- max_daily_hours: æ¯æ—¥æœ€å¤§ä½¿ç”¨æ—¶é•¿
```

#### 2. å»¶é•¿ç”¨æˆ·æ—¶é—´
```
POST /auth_backend/api/admin.php
å‚æ•°ï¼š
- action: extend_time
- admin_key: ç®¡ç†å‘˜å¯†é’¥
- user_id: ç”¨æˆ·ID
- extend_days: å»¶é•¿å¤©æ•°
```

#### 3. è·å–ç”¨æˆ·åˆ—è¡¨
```
POST /auth_backend/api/admin.php
å‚æ•°ï¼š
- action: list_users
- admin_key: ç®¡ç†å‘˜å¯†é’¥
```

#### 4. è·å–åœ¨çº¿ç”¨æˆ·
```
POST /auth_backend/api/admin.php
å‚æ•°ï¼š
- action: list_sessions
- admin_key: ç®¡ç†å‘˜å¯†é’¥
```

#### 5. è¸¢å‡ºç”¨æˆ·
```
POST /auth_backend/api/admin.php
å‚æ•°ï¼š
- action: kick_user
- admin_key: ç®¡ç†å‘˜å¯†é’¥
- user_id: ç”¨æˆ·ID
```

## ğŸ”§ é›†æˆåˆ°ä¸»ç¨‹åº

### 1. å¯¼å…¥è®¤è¯æ¨¡å—

```python
from auth_client import AuthClient, AuthDialog

# åˆ›å»ºè®¤è¯å®¢æˆ·ç«¯
auth_client = AuthClient("http://43.142.176.53:8805")  # ç”Ÿäº§ç¯å¢ƒ
# auth_client = AuthClient("http://localhost:8805")    # æµ‹è¯•ç¯å¢ƒ
```

### 2. åœ¨ç¨‹åºå¯åŠ¨æ—¶è¿›è¡Œè®¤è¯

```python
def main():
    # æ˜¾ç¤ºç™»å½•å¯¹è¯æ¡†
    auth_dialog = AuthDialog(auth_client)
    
    if not auth_dialog.show_login_dialog():
        print("è®¤è¯å¤±è´¥ï¼Œç¨‹åºé€€å‡º")
        return
    
    # è®¤è¯æˆåŠŸï¼Œå¯åŠ¨ä¸»ç¨‹åº
    app = QApplication(sys.argv)
    dashboard = FacebookDashboard(auth_client)  # ä¼ å…¥è®¤è¯å®¢æˆ·ç«¯
    dashboard.show()
    app.exec_()
```

### 3. åœ¨ç¨‹åºè¿è¡Œä¸­å®šæœŸæ£€æŸ¥

```python
class FacebookDashboard(QMainWindow):
    def __init__(self, auth_client):
        super().__init__()
        self.auth_client = auth_client
        
        # å¯åŠ¨å®šæœŸæ£€æŸ¥
        self.auth_timer = QTimer()
        self.auth_timer.timeout.connect(self.check_auth_status)
        self.auth_timer.start(60000)  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    
    def check_auth_status(self):
        success, message = self.auth_client.verify_auth()
        if not success:
            QMessageBox.critical(self, "è®¤è¯å¤±è´¥", f"{message}\nç¨‹åºå°†é€€å‡º")
            self.close()
        
        # æ£€æŸ¥æ—¶é—´é™åˆ¶
        success, message = self.auth_client.check_time_limit()
        if not success:
            QMessageBox.warning(self, "æ—¶é—´é™åˆ¶", f"{message}\nç¨‹åºå°†é€€å‡º")
            self.close()
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç³»ç»Ÿé…ç½® (`config/config.php`)

```php
// é»˜è®¤è®¾ç½®
define('DEFAULT_MAX_SIMULATORS', 5);     // é»˜è®¤æœ€å¤§è®¾å¤‡æ•°
define('DEFAULT_DAILY_HOURS', 24);       // é»˜è®¤æ¯æ—¥æœ€å¤§ä½¿ç”¨æ—¶é•¿
define('SESSION_TIMEOUT', 3600);         // ä¼šè¯è¶…æ—¶æ—¶é—´(ç§’)
define('HEARTBEAT_TIMEOUT', 300);        // å¿ƒè·³è¶…æ—¶æ—¶é—´(ç§’)
define('ADMIN_KEY', 'fb_admin_2025');    // ç®¡ç†å‘˜å¯†é’¥
```

### æœåŠ¡å™¨åœ°å€é…ç½®

- **æµ‹è¯•ç¯å¢ƒï¼š** `http://localhost:8805`
- **ç”Ÿäº§ç¯å¢ƒï¼š** `http://43.142.176.53:8805`

## ğŸ“Š ç®¡ç†åå°åŠŸèƒ½

### ä»ªè¡¨æ¿
- æ˜¾ç¤ºç³»ç»Ÿæ¦‚è§ˆç»Ÿè®¡
- æ€»ç”¨æˆ·æ•°ã€æ´»è·ƒç”¨æˆ·æ•°ã€åœ¨çº¿ç”¨æˆ·æ•°ã€è¿‡æœŸç”¨æˆ·æ•°

### ç”¨æˆ·ç®¡ç†
- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯
- ç”¨æˆ·ç»­è´¹ï¼ˆå»¶é•¿ä½¿ç”¨æ—¶é—´ï¼‰
- è¸¢å‡ºåœ¨çº¿ç”¨æˆ·

### åœ¨çº¿ç”¨æˆ·ç›‘æ§
- å®æ—¶æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·
- æ˜¾ç¤ºç™»å½•æ—¶é—´ã€æœ€åå¿ƒè·³ã€ä½¿ç”¨æ—¶é•¿

### åˆ›å»ºç”¨æˆ·
- åˆ›å»ºæ–°ç”¨æˆ·è´¦å·
- è®¾ç½®æˆæƒæœŸé™å’Œä½¿ç”¨é™åˆ¶

## ğŸ”’ å®‰å…¨ç‰¹æ€§

1. **å¯†ç åŠ å¯†** - ä½¿ç”¨PHP password_hash()å‡½æ•°
2. **è®¾å¤‡ç»‘å®š** - åŸºäºMACåœ°å€å’Œè®¡ç®—æœºåç”Ÿæˆè®¾å¤‡ID
3. **ä¼šè¯ç®¡ç†** - Tokenæœºåˆ¶ï¼Œæ”¯æŒè¶…æ—¶è‡ªåŠ¨å¤±æ•ˆ
4. **å¿ƒè·³æ£€æµ‹** - å®æ—¶ç›‘æ§å®¢æˆ·ç«¯çŠ¶æ€
5. **æ“ä½œæ—¥å¿—** - è®°å½•æ‰€æœ‰é‡è¦æ“ä½œ

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½** - å®šæœŸå¤‡ä»½ `data/` ç›®å½•ä¸‹çš„JSONæ–‡ä»¶
2. **ç®¡ç†å‘˜å¯†é’¥** - ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹é»˜è®¤çš„ç®¡ç†å‘˜å¯†é’¥
3. **æœåŠ¡å™¨å®‰å…¨** - ç¡®ä¿WebæœåŠ¡å™¨çš„å®‰å…¨é…ç½®
4. **æ–‡ä»¶æƒé™** - ç¡®ä¿ `data/` ç›®å½•æœ‰å†™å…¥æƒé™

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•åˆ›å»ºæ•°æ®æ–‡ä»¶**
   - æ£€æŸ¥ `data/` ç›®å½•æƒé™
   - ç¡®ä¿PHPæœ‰å†™å…¥æƒé™

2. **è®¤è¯å¤±è´¥**
   - æ£€æŸ¥æœåŠ¡å™¨åœ°å€æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥æˆæƒæ˜¯å¦è¿‡æœŸ

3. **è®¾å¤‡æ•°é‡é™åˆ¶**
   - åœ¨ç®¡ç†åå°è¸¢å‡ºå¤šä½™è®¾å¤‡
   - æˆ–å¢åŠ ç”¨æˆ·çš„æœ€å¤§è®¾å¤‡æ•°é™åˆ¶

4. **æ—¶é—´é™åˆ¶**
   - åœ¨ç®¡ç†åå°ä¸ºç”¨æˆ·ç»­è´¹
   - æˆ–è°ƒæ•´æ¯æ—¥ä½¿ç”¨æ—¶é•¿é™åˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. PHPé”™è¯¯æ—¥å¿—
2. ç³»ç»Ÿæ“ä½œæ—¥å¿— (`data/logs.json`)
3. ç½‘ç»œè¿æ¥çŠ¶æ€
4. æœåŠ¡å™¨é…ç½®

---

**ç‰ˆæœ¬ï¼š** 1.0  
**æ›´æ–°æ—¶é—´ï¼š** 2025-12-01
